<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width">
    <title>HeroUnion - 开源网络爬虫联盟。</title>
    <meta name="author" content="HeroUnion.website">
    <meta name="description" content="HeroUnion - 开源网络爬虫联盟。">
    <style>
        *,body{margin:0;padding:0}
        body{padding:8px;max-width:640px;margin:0 auto}
        h1{font-size:2em;font-weight:500}
        small{font-size:65%;font-weight:400}
        pre{background-color:#DDD;padding-bottom:3px;padding-right:3px;border-radius:0 5px 0 5px;max-width:480px}
        code{display:block;background-color:#EEE;padding:4px}
        dt{background-color:#EEE;padding:4px 6px}
        dd{text-indent:1em;margin:4px 0 8px 0}
        li{margin-left:1em}
        footer{padding-bottom:2em}

        .text-center{text-align:center}
        .text-right{text-align:right}
        .mt-d5{margin-top:.5em}
        .mt-1{margin-top:1em}
        .mt-2{margin-top:2em}
        .mt-4{margin-top:4em}
        .mx-d2{margin-left:.5em;margin-right:.2em}
        .icon{vertical-align:middle}

        .stats{background-color:#EEE;padding:10px 10px 4px 10px}
        .col{display:inline-block;padding:13px 4px;width:20%;background:#444;color:#FFF;margin-right:4px;margin-bottom:6px;text-align:center}
        .col strong{font-size:24px}
        .col label{display:block;font-size:15px}
        .info{background-color:darkblue}
        .success{background-color:green}
        .warning{background-color:orange;color:#444}
        .danger{background-color:red}
        .disable{background-color:gray}

        .langswitcher{position:relative}
        .langswitcher button{padding:2px 4px;cursor:pointer}
        .dropmenu{display:none;position:absolute;right:0;top:28px;padding:5px;width:80px;background-color:#FFF;border:1px solid #EEE}
        .dropmenu li{list-style:none;padding:0;margin:3px 0;text-align:center}

        @media(max-width:480px) {
            h1 small{display:block}
        }
    </style>
</head>
<body>
    <h1 class="text-center">HeroUnion<small> - 开源网络爬虫联盟</small></h1>

    <hr class="mt-d5">
    <div class="text-right mt-d5 langswitcher">
        <button data-status="closed">
            <img src="/globe.svg" alt="Globe language switcher" class="icon">
            简体中文
        </button>
        <ul class="dropmenu">
            <li><a href="/">English</a></li>
            <li><a href="/zh/">简体中文</a></li>
            <li><a href="/zh-tw/">繁體中文</a></li>
            <li><a href="/es/">Español</a></li>
            <li><a href="/de/">Deutsch</a></li>
            <li><a href="/ru/">Русский</a></li>
            <li><a href="/ja/">日本語</a></li>
            <li><a href="/hi/">हिन्दी</a></li>
        </ul>
    </div>

    <h3 class="mt-2">HeroUnion状态 <small>已运行 <span class="run_time">...</span></small></h3>

    <h4 class="mt-d5">任务状态 <small>(最近 <span class="cache_time">...</span>)</small></h4>
    <div class="stats taskStatus">
        <span class="col info">
            <strong class="waiting">...</strong>
            <label>等待中</label>
        </span>
        <span class="col warning">
            <strong class="running">...</strong>
            <label>正在运行</label>
        </span>
        <div>
            <span class="col">
                <strong class="total">...</strong>
                <label>总计</label>
            </span>
            <span class="col success">
                <strong class="done">...</strong>
                <label>已完成</label>
            </span>
            <span class="col danger">
                <strong class="failed">...</strong>
                <label>失败</label>
            </span>
        </div>
    </div>

    <h4 class="mt-d5">通知状态 <small>(最近 <span class="cache_time">...</span>)</small></h4>
    <div class="stats taskNotifyStatus">
        <span class="col">
            <strong class="total">...</strong>
            <label>总计</label>
        </span>
        <span class="col success">
            <strong class="done">...</strong>
            <label>已完成</label>
        </span>
        <span class="col danger">
            <strong class="failed">...</strong>
            <label>失败</label>
        </span>
    </div>

    <h4 class="mt-d5">机器人状态</h4>
    <div class="stats heroStatus">
        <span class="col">
            <strong class="total">...</strong>
            <label>总计</label>
        </span>
        <span class="col success">
            <strong class="idle">...</strong>
            <label>空闲</label>
        </span>
        <span class="col warning">
            <strong class="busy">...</strong>
            <label>繁忙</label>
        </span>
        <span class="col disable">
            <strong class="offline">...</strong>
            <label>离线</label>
        </span>
    </div>

    <h4 class="mt-d5">JSON数据</h4>
    <pre><code id="herounion_stats">...</code></pre>

    <h3 class="mt-2">联盟盟约</h3>
    <p class="mt-1">为了您自己和整个社会更美好的明天，请遵守以下约定并坚持下去！</p>
    <ul class="mt-d5">
        <li>遵守当地/国家法律法规</li>
        <li>受法律保护的信息将不会被抓取 (例如: 个人隐私数据、手机号码、身份证号码等。)</li>
        <li>需要登录或VIP身份才能访问的数据将不会被抓取</li>
        <li>目标网站明确禁止收集的数据将不会被抓取</li>
        <li>目标网站的商业核心数据将不会被抓取</li>
        <li>低并发、低频率，不影响目标网站的正常运行</li>
    </ul>

    <h3 class="mt-2">机器人</h3>
    <dl class="mt-d5" id="herobots">...</dl>

    <h3 class="mt-2">HeroUnion App</h3>
    <ul class="mt-d5">
        <li>
            <strong>网站监控:</strong>
            <a href="https://monitor.filesite.io/d/ddntdyyhv943ke/e7bd91-e7ab99-e79b91-e68ea7?orgId=1" target="_blank">FileSite.io Monitor</a>,
            <a href="https://github.com/filesite-io/monit-via-herounion" target="_blank">Monitor source code download</a>
        </li>
        <li>
            <strong>网页爬虫:</strong>
            <a href="https://tajian.tv/" target="_blank">TaJian.tv - video box</a>，
            <a href="https://github.com/filesite-io/machete" target="_blank">Machete source code download</a>
        </li>
    </ul>

    <h3 class="mt-2">HeroUnion下载</h3>
    <p><a href="https://github.com/filesite-io/herounion" target="_blank">https://github.com/filesite-io/herounion</a></p>

    <h3 class="mt-2">HeroBot下载</h3>
    <p><a href="https://github.com/filesite-io/machete_hero" target="_blank">https://github.com/filesite-io/machete_hero</a></p>


    <footer class="mt-4">
        <p>
            <strong>免责声明:</strong>
            <br>HeroUnion<strong>仅负责爬虫和任务的调度</strong>，
            爬虫支持的合约及任务的具体内容与联盟无关。
        </p>
        <p class="mt-2 text-center">&copy;copyright <a href="https://herounion.website/" target="_blank">HeroUnion.Website</a></p>
    </footer>

    <script src="/js/jquery-3.7.1.min.js"></script>
    <script type="text/javascript">
        var toggleLangSwitcher = function(evt) {
            var btn = evt.target;
            if (!btn) {return false;}
            var status = $(btn).attr('data-status');
            if (status == 'closed') {
                $('.langswitcher .dropmenu').show();
                $(btn).attr('data-status', 'opened');
            }else {
                $('.langswitcher .dropmenu').hide();
                $(btn).attr('data-status', 'closed');
            }
        };
        $('.langswitcher button').click(toggleLangSwitcher);

        var formatSeconds = function(secs) {
            var str = secs + ' seconds';
            if (secs > 86400) {
                str = Math.floor(secs/86400) + ' days';
            }else if (secs > 3600) {
                str = Math.floor(secs/3600) + ' hours';
            }else if (secs > 300) {
                str = Math.floor(secs/60) + ' minutes';
            }else if (secs > 86400*365) {
                str = Math.floor(secs/86400/365) + ' years'
                        + Math.floor( (secs - Math.floor(secs/86400/365)) / 86400 ) + ' days';
            }

            return str;
        };

        var renderStats = function(parentCls, data) {
            for (var key in data) {
                $('.' + parentCls + ' .'+key).text(data[key]);
            }
        };

        var htmlspecialchars = function(str) {
            return str.replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;');
        };

        var renderHeros = function(heros) {
            if (!heros || heros.length == 0) {
                $('#herobots').text('There is no bot online.');
                return;
            }

            var txtStatus = {idle: 'Idle', busy: 'Busy', offline: 'Offline'};
            var html = '', item;
            for (var index in heros) {
                item = heros[index];
                html += '<dt>' + htmlspecialchars(item['name']) + ' <small>'
                        + txtStatus[item['status']] + '</small></dt>';
                html += '<dd>'
                        + htmlspecialchars(item['description'])
                        + '<br>Platforms: ' + JSON.stringify(item['platforms'])
                        + ', Contracts: ' + JSON.stringify(item['contracts'])
                        + ', Contact: ' + htmlspecialchars(item['contact'])
                        + '</dd>';
            }

            $('#herobots').html(html);
        };

        var loadUnionStats = function() {
            $('.run_time').text('...');
            var api = '/api/stats/';
            $.ajax({
                url: api,
                method: 'GET',
                dataType: 'json'
            }).done(function(data) {
                $('#herounion_stats').text(JSON.stringify(data, null, 4));
                $('.run_time').text( formatSeconds(data.run_seconds) );
                $('.cache_time').text( formatSeconds(data.cache_time) );
                renderStats('taskStatus', data.taskStatus);
                renderStats('taskNotifyStatus', data.taskNotifyStatus);
                renderStats('heroStatus', data.heroStatus);
            });
        };

        var loadHeros = function() {
            $('#herobots').text('...');
            var api = '/api/heros/';
            $.ajax({
                url: api,
                method: 'GET',
                dataType: 'json'
            }).done(function(data) {
                renderHeros(data);
            });
        };

        //init
        loadUnionStats();
        loadHeros();

        setInterval(loadUnionStats, 20000);
    </script>
</body>
</html>